DIR_UTIL=/planics1/procesos/soptec/util
export DIR_UTIL
#Valida existencia y permisos de ejecucion del shell encab_ini.sh
if [ ! -x ${DIR_UTIL}/encab_ini.sh ] ; then
 echo "NO existe encab_ini.sh, el proceso NO puede continuar"
 exit 1
fi
. $DIR_UTIL/encab_ini.sh $0_"`hostname`" "Inicializar el proceso shl_ABSsrvr.sh" ABSsrvr


ValidaInicio Sin_Base

export SERV_RUTA_DATOS="${DIR_INTERFACES}/"
export ARCHPROC="ABSsrvrLC"                       #Nombre del proceso a ejecutar
export BITACORAABSsrvr="$ARCHPROC.log"          #Escucha a CAAAREM y le habla al banco -entrada-
export ArchSal="shl_$ARCHPROC.log"              #Archivo de salida del shell


#BITACORAS
echo > $ArchSal
echo "Inicia la ejecucion del proceso [shl_$ARCHPROC.sh]." >> $ArchSal
echo "Fecha de proceso: $( date '+%d-%b-%Y %H:%M' )" >> $ArchSal

$DIR_PROG/$ARCHPROC >> $ArchSal
res_bin=${?}

if [ $res_bin -eq 137 ]; then
	echo "Proceso finalizado por el monitor [$(date '+%d-%b-%Y %H:%M:%S')]" >> $ArchSal

	if [ -f "$DIR_INTERFACES/ABSsrvr.ko" ]; then
		rm "$DIR_INTERFACES/ABSsrvr.ko" >>/dev/null 2>>/dev/null
		echo "No se reiniciara el proceso, ha sido terminado 10 veces" >> $ArchSal
      exit 98 #Terminado 10 veces seguidas
	else
		exit 99 #Codigo para reinicio por Control-M
	fi
fi



echo "Fin de la ejecucion del proceso [shl_$ARCHPROC.sh]." >> $ArchSal
echo "Fecha de proceso: $( date '+%d-%b-%Y %H:%M' )" >> $ArchSal
echo " FIN `date` " >> $ArchSal

ValidaEstatus
